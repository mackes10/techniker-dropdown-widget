<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Techniker Dropdown</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    select {
      width: 100%;
      padding: 8px;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <label for="technikerSelect">Bitte Techniker auswählen:</label>
  <select id="technikerSelect">
    <option value="" disabled selected>Wähle einen Techniker</option>
  </select>

  <script>
    // Funktion zum Parsen von data-params
    function getParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const raw = urlParams.get('data-params');
      if (!raw) return null;
      try {
        return JSON.parse(decodeURIComponent(raw));
      } catch (e) {
        console.error("Fehler beim Parsen von data-params:", e);
        return null;
      }
    }

    // Dropdown befüllen
    function populateDropdown(config) {
      const dropdown = document.getElementById('technikerSelect');
      if (!config || !config.data || !Array.isArray(config.data.items)) return;

      config.data.items.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        dropdown.appendChild(option);
      });

      if (config.data.default) {
        dropdown.value = config.data.default;
      }
    }

    // Sende ausgewählten Wert zurück an Jotform
    function setupPostMessage() {
      const dropdown = document.getElementById('technikerSelect');
      function sendValue() {
        const value = dropdown.value;
        parent.postMessage({ action: "setValue", value }, "*");
      }

      dropdown.addEventListener("change", sendValue);
      sendValue(); // auch initial senden
    }

    // Initialisierung
    const config = getParams();
    if (config && config.data && Array.isArray(config.data.items)) {
      populateDropdown(config);
      setupPostMessage();
    } else {
      document.body.innerHTML = "<p style='color:red;'>Fehler: Keine gültigen Daten übergeben.</p>";
    }
  </script>

</body>
</html>
